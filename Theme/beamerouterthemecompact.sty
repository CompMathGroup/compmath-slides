% Copyright 2007 by Till Tantau
% Copyright 2014 by Ivan Tsybulin <tsybulin@crec.mipt.ru>
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
% See the file doc/licenses/LICENSE for more details.

\newlength{\allmarks}\setlength{\allmarks}{.3\paperwidth}
\newlength{\lrmargin}\setlength{\lrmargin}{.2em}
\addtolength{\allmarks}{-2\lrmargin}
\newlength{\onemark}
\newlength{\pbmargin}\setlength{\pbmargin}{.2ex}
\newlength{\pbheight}\setlength{\pbheight}{.8ex}
\newlength{\pbheightwithmargins}
\setlength{\pbheightwithmargins}{\pbheight}
\addtolength{\pbheightwithmargins}{2\pbmargin}

\mode<presentation>

\setbeamercolor*{author in head/foot}{parent=palette tertiary}
\setbeamercolor*{title in head/foot}{parent=palette secondary}
\setbeamercolor*{date in head/foot}{parent=palette primary}

\setbeamercolor*{section in head/foot}{parent=palette tertiary}
\setbeamercolor*{subsection in head/foot}{parent=palette primary}

\defbeamertemplate*{footline}{compact theme}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.2\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor\expandafter\beamer@ifempty\expandafter{\beamer@shortinstitute}{}{~~(\insertshortinstitute)}
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.4\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.3\paperwidth,ht=2.25ex,dp=1ex,center]{date in head/foot}%
    \setlength{\onemark}{\allmarks}%
    \divide\onemark\inserttotalframenumber%
	\hspace*{\lrmargin}%
	\hspace{-\pbmargin}%
	{\usebeamercolor[bg]{palette secondary}%
	\rule[-\pbmargin]{\allmarks}{\pbheightwithmargins}%
	\rule[-\pbmargin]{2\pbmargin}{\pbheightwithmargins}}%
	\hspace{-\allmarks}%
	\hspace{-\pbmargin}%
    \rule{\theframenumber\onemark}{\pbheight}%
    \hspace{-\theframenumber\onemark}%
    \hspace{\allmarks}%
    \hspace*{\lrmargin}%
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.1\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \insertframenumber{} / \inserttotalframenumber%
  \end{beamercolorbox}}%
  \vskip0pt%
}

\defbeamertemplate*{headline}{compact theme}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.65ex,dp=1.5ex,right]{section in head/foot}%
    \usebeamerfont{section in head/foot}\insertsectionhead\hspace*{2ex}
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.65ex,dp=1.5ex,left]{subsection in head/foot}%
    \usebeamerfont{subsection in head/foot}\hspace*{2ex}\insertsubsectionhead
  \end{beamercolorbox}}%
  \vskip0pt%
}

\setbeamersize{text margin left=1em,text margin right=1em}
\setbeamertemplate{navigation symbols}{}

\mode
<all>
